# 第2章

## 1.

```
declare P

proc {P X}
   if X>0 then {P X-1} end
end
{P 10}
```

核言語に翻訳すると

```
declare P

P = proc {$ X}
       local T in
	  T = X > 0
	  if T then
	     local V in
		V = X - 1
		{P V}
	     end
	  end
       end
    end
```

識別子Pの2番めの出現は自由である。
文 `P = proc {$ X} ... end` において P は宣言されていないからである. (p.65)

## 2.

```
local MulByN in
   local N in
      N = 3
      proc {MulByN X ?Y}
	 Y = N * X
      end
   end

   local A B in
      A = 10
      {MulByN A B}
      {Browse B}
   end
end
```

MulByN には `(proc {$ X ?Y} <body> end, {N -> 3})` が束縛される。
`<body>` 実行時に `N -> 3` が存在しないと、`N * X` を評価することができずエラーになる。

## 3

```
declare F
fun {F X}
   if X > 0 then
      plus
   end
end

declare X Y
X = {F 10}
Y = {F -1}
{Browse X}
{Browse Y}
```

例外が発生しない...
仕様が変わったのかも

手続きの場合は、値を返すわけではないので、else節がなくても問題にならない。

## 4.

```
if <x> then <s1> else <s2> end

=>

case <x>
of true then <s1>
else <s2>
end

```

## 5.

```
declare Test
proc {Test X}
   case X
   of a|Z then {Browse 'case'(1)}
   [] f(a) then {Browse 'case'(2)}
   [] Y|Z andthen Y == Z then {Browse 'case'(3)}
   [] Y|Z then {Browse 'case'(4)}
   [] f(Y) then {Browse 'case'(5)}
   else {Browse 'case'(6)}
   end
end

{Test [b c a]}  % => case(4)
{Test f(b(3))}  % => case(2) -> 5
{Test f(a)}     % => case(2)				      
{Test f(a(3))}  % => case(5)
{Test f(d)}     % => case(5)
{Test [a b c]}  % => case(1)
{Test [c a d]}  % => case(4)
{Test a|a}      % => case(3) -> 1
```

## 6.

declare Test
proc {Test X}
   case X of f(a Y c) then {Browse 'case'(1)}
   else {Browse 'case'(2)} end
end

declare X Y {Test f(X b Y)} % => case(2)
declare X Y {Test f(a Y d)} % => case(2)
declare X Y {Test f(X Y d)} % => case(2)

declare X Y
if f(X b Y) == f(a Y c) then {Browse 'case'(1)}
else {Browse 'case'(2)} end
